import{cars}from"./catalog.js";const cardsContainer=document.querySelector(".cards__content"),emptyMessage=document.querySelector(".cards__content-empty");let cardsToShow=5;function updateCardsToShow(){const e=window.innerWidth;cardsToShow=e>=1280?5:e>=1024?4:e>=580?6:3}const btnLoadMore=document.querySelector(".cards__btn-else");function createPaginationItem(e){const t=document.createElement("li");return t.classList.add("card__pagination-item"),t.setAttribute("data-index",e),t.classList.toggle("active",0===e),t}function updatePagination(e,t){e.querySelectorAll(".card__pagination-item").forEach((e=>e.classList.remove("active"))),e.querySelector(`.card__pagination-item[data-index="${t}"]`).classList.add("active")}function resetPagination(e){e.querySelectorAll(".card__pagination-item").forEach((e=>e.classList.remove("active"))),e.querySelector('.card__pagination-item[data-index="0"]').classList.add("active")}function fillCardData(e,t){e.querySelector(".card__price-js").textContent=t.price.toLocaleString("ru-RU");e.querySelector(".card__car-brand").textContent=`${t.brand}`;e.querySelector(".card__car-model").textContent=`${t.model}`;e.querySelector(".card__transmission").textContent=`${t.transmission}`;e.querySelector(".card__motor").textContent=`${t.motor}`;e.querySelector(".card__mileage").textContent=t.mileage.toLocaleString("ru-RU");e.querySelector(".card__motor-type").textContent=`${t.motorType}`;e.querySelector(".card__power").textContent=`${t.power}`;e.querySelector(".card__drive").textContent=`${t.drive}`}function createCard(e){const t=document.querySelector(".card-template").content.cloneNode(!0),r=t.querySelector(".card");if(!r)return null;r.setAttribute("data-year",e.year);const o=t.querySelector(".card__images"),n=t.querySelector(".card__image-item"),a=t.querySelector(".card__pagination-list");o.innerHTML="",a.innerHTML="",e.img.length>1?a.style.display="flex":a.style.display="none",e.img.forEach(((t,c)=>{const l=n.cloneNode(!0);l.setAttribute("data-index",c);const s=l.querySelector("img");s.src=t,s.alt=`${e.brand} ${e.model}`,l.addEventListener("mouseenter",(e=>{updatePagination(r,e.currentTarget.dataset.index)})),l.addEventListener("mouseleave",(()=>{resetPagination(r)}));o.querySelectorAll(".card__image-item").forEach((e=>{e.addEventListener("touchstart",handleTouchStart,!1),e.addEventListener("touchmove",handleTouchMove,!1)})),o.appendChild(l);const i=createPaginationItem(c);a.appendChild(i)})),fillCardData(r,e);const c=t.querySelector(".card__btn-popup");c&&c.addEventListener("click",(()=>{pageBody.classList.add("stop-scroll"),openPopup(popupForm)}));const l=t.querySelector(".card__btn-info");return l&&l.addEventListener("click",(()=>openPopupCard(e))),t}function renderCards(e){const t=document.querySelector(".cards__content");t.querySelectorAll(".card").forEach((e=>e.remove()));e.slice(0,cardsToShow).forEach((e=>{const r=createCard(e);r&&t.appendChild(r)}));const r=document.querySelector(".cards__btn-else");cardsToShow>=e.length?r.style.display="none":r.style.display="block",0===e.length?emptyMessage.style.display="block":emptyMessage.style.display="none"}function openPopupCard(e){const t=document.querySelector(".popup-card");t.querySelector(".popup-card__car-brand").textContent=e.brand,t.querySelector(".popup-card__car-model").textContent=e.model,t.querySelector(".popup-card__transmission").textContent=e.transmission,t.querySelector(".popup-card__motor").textContent=e.motor,t.querySelector(".popup-card__mileage").textContent=e.mileage.toLocaleString("ru-RU"),t.querySelector(".popup-card__motor-type").textContent=e.motorType,t.querySelector(".popup-card__power").textContent=e.power,t.querySelector(".popup-card__drive").textContent=e.drive,t.querySelector(".popup-card__body-type").textContent=e.bodyType,t.querySelector(".popup-card__equipment").textContent=e.equipment,t.querySelector(".popup-card__color").textContent=e.color,t.querySelector(".popup-card__year").textContent=e.year,t.querySelector(".popup-card__condition").textContent=e.condition,t.querySelector(".popup-card__guarantee").textContent=e.guarantee,t.querySelector(".popup-card__description").textContent=e.description,t.querySelector(".popup-card__price-js").textContent=e.price.toLocaleString("ru-RU");const r=t.querySelector(".popup-card__slide"),o=t.querySelector(".slider .popup-card__slider-wrapper"),n=t.querySelector(".slider2 .popup-card__slider-wrapper");o.innerHTML="",n.innerHTML="",e.img.forEach((t=>{const a=r.cloneNode(!0),c=a.querySelector("img");c.src=t,c.alt=`${e.brand} ${e.model}`,o.appendChild(a);const l=r.cloneNode(!0),s=l.querySelector("img");s.src=t,s.alt=`${e.brand} ${e.model}`,n.appendChild(l)}));const a=new Swiper(".slider",{slideClass:"popup-card__slide",wrapperClass:"popup-card__slider-wrapper",loop:!0,spaceBetween:10,slidesPerView:4,freeMode:!0,watchSlidesProgress:!0,breakpoints:{760:{spaceBetween:14},1280:{spaceBetween:20}}});new Swiper(".slider2",{slideClass:"popup-card__slide",wrapperClass:"popup-card__slider-wrapper",spaceBetween:10,loop:!0,pagination:{el:".popup-card__pagination",type:"bullets"},navigation:{nextEl:".popup-card__btn-next",prevEl:".popup-card__btn-prev"},thumbs:{swiper:a}});t.classList.add("open"),header.style.opacity="0",hideScroll()}btnLoadMore.addEventListener("click",(()=>{cardsToShow+=6,renderCards(filteredCars)})),updateCardsToShow(),cardsContainer&&cars.forEach((e=>{const t=createCard(e);t&&cardsContainer.appendChild(t)}));let xDown=null;function handleTouchStart(e){const t=e.touches[0];xDown=t.clientX}function handleTouchMove(e){if(!xDown)return;let t=e.touches[0].clientX,r=xDown-t;if(Math.abs(r)>40){const t=e.currentTarget.closest(".card");r>0?nextImage(t):previousImage(t),xDown=null}}function nextImage(e){const t=(parseInt(e.querySelector(".card__pagination-item.active").dataset.index)+1)%e.querySelectorAll(".card__image-item").length;updatePagination(e,t),updateImageDisplay(e,t)}function previousImage(e){const t=parseInt(e.querySelector(".card__pagination-item.active").dataset.index),r=e.querySelectorAll(".card__image-item").length,o=(t-1+r)%r;updatePagination(e,o),updateImageDisplay(e,o)}function updateImageDisplay(e,t){e.querySelectorAll(".card__image-item").forEach(((e,r)=>{e.style.opacity=r===t?"1":"0"}))}let filteredCars=[],selectedBrands=[];const filterTypeBtns=document.querySelectorAll(".type-else .filters__btn"),mileageBtns=document.querySelectorAll(".type-car .filters__btn");let selectedType="auto",selectedMileage="all";filterTypeBtns.forEach((e=>{e.addEventListener("click",(e=>{selectedType=e.currentTarget.getAttribute("data-type"),updateCardsToShow(),filterCars(),resetButton.classList.add("active"),resetButton.disabled=!1}))})),mileageBtns.forEach((e=>{e.addEventListener("click",(e=>{selectedMileage=e.currentTarget.getAttribute("data-drive"),updateCardsToShow(),filterCars(),resetButton.classList.add("active"),resetButton.disabled=!1}))}));const priceRange=document.getElementById("price-range"),minPriceOutput=document.getElementById("min-price"),maxPriceOutput=document.getElementById("max-price");let minPrice=parseInt(priceRange.min,10),maxPrice=parseInt(priceRange.value,10);minPriceOutput.textContent=parseInt(priceRange.min,10).toLocaleString("ru-RU"),maxPriceOutput.textContent=parseInt(priceRange.value,10).toLocaleString("ru-RU"),priceRange.addEventListener("input",(()=>{maxPrice=parseInt(priceRange.value,10),maxPriceOutput.textContent=maxPrice.toLocaleString("ru-RU"),filterCars(),checkFiltersChanged()})),priceRange.addEventListener("input",(()=>{const e=(priceRange.value-priceRange.min)/(priceRange.max-priceRange.min)*100;priceRange.style.background="linear-gradient(to right, var(--red) "+e+"%, #8A8A8A "+e+"%)"}));const headingFilters=document.querySelectorAll(".select-heading-js"),brandItems=document.querySelectorAll(".filters__brand-item"),titleAll=document.querySelector(".filters__current-title-all"),titleChoice=document.querySelector(".filters__current-title-choice");let isBrandListExpanded=!1;headingFilters.forEach((e=>{e.addEventListener("click",(()=>{const t=e.classList.contains("open");headingFilters.forEach((e=>{e.classList.remove("open"),isBrandListExpanded=!1})),t||(e.classList.add("open"),isBrandListExpanded=!0),isBrandListExpanded?selectedBrandList.classList.remove("visible"):selectedBrandList.classList.add("visible")}))})),brandItems.forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-brand");selectedBrands.includes(t)?(selectedBrands=selectedBrands.filter((e=>e!==t)),e.classList.remove("selected"),removeBrandFromList(t)):(selectedBrands.push(t),e.classList.add("selected"),addBrandToList(t)),selectedBrands.length>0?(titleAll.style.display="none",titleChoice.style.display="block"):(titleAll.style.display="block",titleChoice.style.display="none"),checkFiltersChanged(),filterCars()}))}));const selectedBrandList=document.querySelector(".filters__brand-list-selected");function addBrandToList(e){const t=document.createElement("li");t.classList.add("selected-brand");const r=document.createElement("p");r.classList.add("selected-brand__name"),r.textContent=e;const o=document.createElement("button");o.type="button",o.classList.add("selected-brand__del"),o.innerHTML='\n    <svg width="8" height="7" viewBox="0 0 8 7" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path\n                              d="M3.55815 3.18594L0.966278 0.594692C0.937224 0.565637 0.914176 0.531143 0.898452 0.493181C0.882727 0.455219 0.874634 0.414532 0.874634 0.373442C0.874634 0.332352 0.882727 0.291664 0.898452 0.253702C0.914176 0.21574 0.937224 0.181247 0.966278 0.152192C0.995333 0.123137 1.02983 0.100089 1.06779 0.0843646C1.10575 0.0686402 1.14644 0.0605469 1.18753 0.0605469C1.22862 0.0605469 1.26931 0.0686402 1.30727 0.0843646C1.34523 0.100089 1.37972 0.123137 1.40878 0.152192L4.00003 2.74407L6.59128 0.152192C6.64996 0.0935124 6.72954 0.0605469 6.81253 0.0605469C6.89551 0.0605469 6.9751 0.0935124 7.03378 0.152192C7.09246 0.210871 7.12542 0.290457 7.12542 0.373442C7.12542 0.456427 7.09246 0.536013 7.03378 0.594692L4.4419 3.18594L7.03378 5.77719C7.09246 5.83587 7.12542 5.91546 7.12542 5.99844C7.12542 6.08143 7.09246 6.16101 7.03378 6.21969C6.9751 6.27837 6.89551 6.31134 6.81253 6.31134C6.72954 6.31134 6.64996 6.27837 6.59128 6.21969L4.00003 3.62782L1.40878 6.21969C1.3501 6.27837 1.27051 6.31134 1.18753 6.31134C1.10454 6.31134 1.02496 6.27837 0.966278 6.21969C0.907599 6.16101 0.874634 6.08143 0.874634 5.99844C0.874634 5.91546 0.907599 5.83587 0.966278 5.77719L3.55815 3.18594Z"\n                              fill="white" />\n                          </svg>\n  ',o.addEventListener("click",(r=>{r.stopPropagation(),selectedBrands=selectedBrands.filter((t=>t!==e)),t.remove(),removeBrandFromList(e),checkFiltersChanged(),filterCars()})),t.appendChild(r),t.appendChild(o),selectedBrandList.appendChild(t)}function removeBrandFromList(e){selectedBrandList.querySelectorAll(".selected-brand").forEach((t=>{t.querySelector(".selected-brand__name").textContent===e&&t.remove()}));document.querySelectorAll(".filters__brand-list .brand-item").forEach((t=>{t.getAttribute("data-brand")===e&&t.classList.remove("selected")}))}let yearFrom=null,yearTo=null;const yearFromInput=document.getElementById("year-from"),yearToInput=document.getElementById("year-to");function filterCars(){filteredCars=cars.filter((e=>{const t=e.mileage,r=e.type===selectedType,o="new"===selectedMileage&&0===t||"run"===selectedMileage&&t>0||"all"===selectedMileage,n=0===selectedBrands.length||selectedBrands.includes(e.brand),a=parseInt(e.year.replace(/\sг\.$/,""),10),c=(null===yearFrom||a>=yearFrom)&&(null===yearTo||a<=yearTo),l=e.price>=minPrice&&e.price<=maxPrice;return r&&o&&n&&c&&l})),renderCards(filteredCars)}yearFromInput.addEventListener("input",(()=>{yearFrom=parseInt(yearFromInput.value,10)||null,filterCars()})),yearToInput.addEventListener("change",(()=>{yearTo=parseInt(yearToInput.value,10)||null,filterCars()})),filterCars(),window.addEventListener("resize",(()=>{updateCardsToShow(),renderCards(filteredCars)}));const resetButton=document.querySelector(".filters__btn-reset"),filterInputs=document.querySelectorAll(".filter-input");function checkFiltersChanged(){let e=!1;filterInputs.forEach((t=>{(t.value!==t.defaultValue||parseInt(priceRange.value,10)<parseInt(priceRange.max,10))&&(e=!0)})),selectedBrands.length>0&&(e=!0),e?(resetButton.classList.add("active"),resetButton.disabled=!1):(resetButton.classList.remove("active"),resetButton.disabled=!0)}function resetFilters(){filterInputs.forEach((e=>{e.value=e.defaultValue})),priceRange.value=priceRange.max,maxPriceOutput.textContent=priceRange.max.toLocaleString("ru-RU"),maxPrice=parseInt(priceRange.value,10);const e=(priceRange.value-priceRange.min)/(priceRange.max-priceRange.min)*100;priceRange.style.background="linear-gradient(to right, var(--red) "+e+"%, #8A8A8A "+e+"%)",selectedBrands=[],brandItems.forEach((e=>{e.classList.remove("selected")})),selectedBrandList.innerHTML="",titleAll.style.display="block",titleChoice.style.display="none",yearFrom=null,yearTo=null,yearFromInput.value="",yearToInput.value="",selectedType="auto",selectedMileage="all",removeActiveClass(filtersBtnType),removeActiveClass(filtersBtnElse),filterTypeBtns.forEach((e=>{"auto"===e.dataset.type&&e.classList.add("active")})),mileageBtns.forEach((e=>{"all"===e.dataset.drive&&e.classList.add("active")})),checkFiltersChanged(),updateCardsToShow(),filterCars()}filterInputs.forEach((e=>{e.addEventListener("change",checkFiltersChanged),e.addEventListener("input",checkFiltersChanged)})),resetButton.addEventListener("click",resetFilters);const pageBody=document.querySelector(".page"),bodyIntro=document.querySelector(".intro__body"),contentIntro=document.querySelector(".intro__content"),logosIntro=document.querySelector(".intro__logos"),header=document.querySelector(".header"),scrollBarWidth=window.innerWidth-document.documentElement.clientWidth,updateStyles=()=>{let e;bodyIntro.style.paddingBottom=logosIntro.offsetHeight+"px",e=window.innerWidth<=602?18:window.innerWidth<=768?48:85;const t=bodyIntro.offsetWidth-2*e;let r;header.style.maxWidth=t+"px",r=window.innerWidth<=768?44:window.innerWidth<=1280?72:117,contentIntro.style.paddingTop=header.offsetHeight+r+"px"};updateStyles();const logosContainer=document.querySelector(".intro__logos"),logos=document.querySelectorAll(".intro__logo"),logoWidth=document.querySelector(".intro__logo");let scrollPosition=0;const speed=.3;console.log(logoWidth.offsetWidth);const getVisibleLogosCount=()=>Array.from(logos).filter((e=>"none"!==e.style.display&&null!==e.offsetParent)).length;let visibleLogosCount=getVisibleLogosCount(),totalWidth=visibleLogosCount*logoWidth.offsetWidth;function animateScroll(){scrollPosition+=.3,scrollPosition>totalWidth&&(scrollPosition=0),logosContainer.style.transform=`translateX(-${scrollPosition}px)`,requestAnimationFrame(animateScroll)}console.log(totalWidth),animateScroll(),window.addEventListener("resize",(()=>{updateStyles()}));const btnFormClose=document.querySelector(".popup__btn-close"),popupForm=document.querySelector(".popup-form"),popupInfo=document.querySelector(".popup-card"),btnFormOpen=document.querySelectorAll(".btn-popup");function openPopup(e){e.classList.add("open"),document.addEventListener("keydown",closePopupEsc),hideScroll(),header.style.opacity="0",updateStyles()}btnFormOpen.forEach((e=>{e.addEventListener("click",(()=>{openPopup(popupForm)}))})),popupForm.addEventListener("mousedown",(e=>{e.target===e.currentTarget&&closePopup(popupForm)})),popupInfo.addEventListener("mousedown",(e=>{e.target===e.currentTarget&&closePopup(popupInfo)}));const burgerMenu=document.querySelector(".btn-menu"),mobileMenu=document.querySelector(".mobile-menu"),btnMenuClose=document.querySelector(".mobile-menu__btn-close"),linkMenu=document.querySelectorAll(".menu-link-js");function hideScroll(){pageBody.classList.toggle("stop-scroll")}burgerMenu.addEventListener("click",(()=>{mobileMenu.classList.add("open"),hideScroll()})),btnMenuClose.addEventListener("click",(()=>{mobileMenu.classList.remove("open"),hideScroll()})),linkMenu.forEach((e=>{e.addEventListener("click",(()=>{mobileMenu.classList.remove("open"),btnMenuClose.classList.remove("open"),hideScroll()}))}));const filtersBtnType=document.querySelectorAll(".type-car .filters__btn"),filtersBtnElse=document.querySelectorAll(".type-else .filters__btn");function removeActiveClass(e){e.forEach((e=>{e.classList.remove("active")}))}filtersBtnType.forEach((e=>{e.addEventListener("click",(()=>{removeActiveClass(filtersBtnType),e.classList.add("active")}))})),filtersBtnElse.forEach((e=>{e.addEventListener("click",(()=>{removeActiveClass(filtersBtnElse),e.classList.add("active")}))}));const sendForm=document.forms.formPopup,popupSuccess=document.querySelector(".form-success"),btnSuccessClose=document.querySelector(".form-success__btn-close"),btnSuccessCloseBottom=document.querySelector(".form-success__btn");function closePopup(e){e.classList.remove("open"),hideScroll(),document.removeEventListener("keydown",closePopupEsc),header.style.opacity="1",sendForm.reset(),document.body.style.paddingRight="",updateStyles()}function closePopupEsc(e){if("Escape"===e.key){closePopup(document.querySelector(".open"))}}popupSuccess.addEventListener("mousedown",(e=>{e.target===e.currentTarget&&closePopup(popupSuccess)}));const btnPopupCardClose=document.querySelector(".popup-card .popup__btn-close");btnFormClose.addEventListener("click",(()=>closePopup(popupForm))),btnSuccessClose.addEventListener("click",(()=>closePopup(popupSuccess))),btnSuccessCloseBottom.addEventListener("click",(()=>closePopup(popupSuccess))),btnPopupCardClose.addEventListener("click",(()=>closePopup(popupInfo))),AOS.init({offset:120,duration:400,easing:"linear"});const formErrorElement=Array.from(document.querySelectorAll(".empty-error")),showInputError=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.add("input_type_error"),o.textContent=r,o.classList.add("input-error_active")},hideInputError=(e,t)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove("input_type_error"),r.classList.remove("input-error_active"),r.textContent=""},hasInvalidInput=e=>e.some((e=>!e.validity.valid)),toggleButtonState=(e,t)=>{hasInvalidInput(e)?(t.disabled=!0,t.classList.add("btn_inactive")):(t.disabled=!1,t.classList.remove("btn_inactive"),formErrorElement.forEach((e=>{e.textContent=""})))},checkInputValidity=(e,t)=>{t.validity.valid?(hideInputError(e,t),formErrorElement.forEach((e=>{e.textContent=""}))):(formErrorSubmit(),showInputError(e,t,t.validationMessage))};function checkInputValidityCustom(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}const setEventListeners=e=>{const t=Array.from(e.querySelectorAll(".input-validation")),r=e.querySelector(".btn-validation");toggleButtonState(t,r),r.addEventListener("click",(()=>{let r=!0;if(t.forEach((e=>{e.validity.valid||(r=!1)})),r){let t=e.querySelector(".input-name").value,r=e.querySelector(".input-phone").value,o=e.querySelector(".input-email").value,n=JSON.stringify({name:t,phone:r,email:o});fetch("../php/send.php",{method:"POST",headers:{"Content-Type":"application/json"},body:n}).then((e=>e.text())).then((t=>{console.log("Успех"),closePopup(popupForm),popupSuccess.classList.add("open"),hideScroll(),resetErrorMessage(e)})).catch((e=>{formErrorSubmit(),console.error("Error:",e)}))}})),e.addEventListener("submit",(e=>{e.preventDefault(),toggleButtonState(t,r),formErrorElement.forEach((e=>{e.textContent=""}))})),t.forEach((o=>{o.addEventListener("input",(()=>{checkInputValidityCustom(o),checkInputValidity(e,o),checkValidationPhone(o),toggleButtonState(t,r)}))}))},enableValidation=()=>{Array.from(document.querySelectorAll(".form")).forEach((e=>{e.addEventListener("submit",(function(e){e.preventDefault()})),resetErrorMessage(e),setEventListeners(e)}))};function formErrorSubmit(){formErrorElement.forEach((e=>{e.textContent="Заполните все поля для отправки формы."}))}function resetErrorMessage(e){Array.from(e.querySelectorAll(".input-validation")).forEach((t=>{t.value="",hideInputError(e,t)})),formErrorElement.forEach((e=>{e.textContent=""}))}enableValidation();const inputPhone=Array.from(document.querySelectorAll(".input-phone")),phoneErrors=Array.from(document.querySelectorAll(".tel-err"));function checkValidationPhone(e){const t=e.value.replace(/\D/g,"");/^[0-9]{11}$/.test(t)?phoneErrors.forEach((e=>{e.textContent=""})):phoneErrors.forEach((e=>{e.textContent="Некорректный номер телефона"}))}inputPhone.forEach((e=>{e.addEventListener("input",(()=>{IMask(e,{mask:"+7(000) 000-00-00"})}))}));